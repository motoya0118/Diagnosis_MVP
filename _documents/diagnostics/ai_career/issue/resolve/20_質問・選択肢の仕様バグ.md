## タスク
- [ ] 本ドキュメントの`不具合`項を理解してください
- [ ] 本ドキュメントの`修正方針`項を理解してください
- [ ] 規約を読む
  - [ ] `_documents/common/backend/implementation_guidelines.md`
  - [ ] `_documents/common/frontend/implementation_guidelines.md`
- [ ] 共通機能を理解する
  - [ ] `_documents/common/backend/CommonFunctionality.md`
  - [ ] `_documents/common/frontend/CommonFunctionality.md`
- [x] 対象の設計書を読み修正する
  - _documents/diagnostics/ai_career/DB設計.md
  - _documents/diagnostics/ai_career/APIs/03_admin_get_template.md
  - _documents/diagnostics/ai_career/APIs/04_admin_import_structure.md
  - _documents/diagnostics/ai_career/APIs/07_admin_finalize_version.md
  - _documents/diagnostics/ai_career/APIs/21_user_get_form.md
- [x] DBを修正する(modelを修正して、自動コードでマイグレーションを生成する)
- [x] テストDBにマイグレーションを反映しテストを実行する(docker-compose環境で実行すること)
- [ ] テストコードを読み、修正する(TDD)
  - [x] backend/tests/test_admin_get_template.py
  - [x] admin_front/tests/lib/templateDownloader.test.ts
  - [x] backend/tests/test_admin_import_structure.py
  - [x] admin_front/tests/components/ImportStructureCard.test.tsx
  - [x] backend/tests/test_admin_finalize_version.py
  - [x] admin_front/tests/components/FinalizeVersionCard.test.tsx
  - [x] backend/tests/test_user_get_form.py
- [x] テストで修正した箇所、NG箇所の実装側を修正する(TDD)
- [x] 最後にテストがオールグリーンになることを確認する(TDD)
  - [x] docker-compose build && docker-compose run --rm -e TEST_DATABASE_URL="$TEST_DATABASE_URL" backend pytest -q
  - [x] docker compose run --rm admin_front sh -lc "npm ci || npm install; npm run test" 
- [ ] 共通機能を実装した場合は加筆する
  - [ ] `_documents/common/backend/CommonFunctionality.md`
  - [ ] `_documents/common/frontend/CommonFunctionality.md`
- [x] 次に実装するタスクに対して引継ぎ事項を記載する（_documents/notion/diagnostics 配下）
- [x] 運用上の懸念や検討事項を記載する（_documents/notion/diagnostics 配下）

## 実施内容
- version_options の外部キーを version_questions に付け替えるため、`backend/app/models/diagnostic.py` を更新し、新しい FK／インデックス構成に揃ったマイグレーション `backend/alembic/versions/0008_link_version_options_to_version_questions.py` を追加。
- ドキュメントと API 設計書（`_documents/diagnostics/ai_career/DB設計.md` ほか 4 件）を全て改訂し、`version_question_id` 前提のスキーマとクエリに追従。
- 構造インポート・テンプレート出力・ユーザー向けフォーム読取・Finalize の各サービス／ルーターを改修し、ソートや検証を version question 単位で行うよう統一。
- TDD 対象のバックエンドテスト（`backend/tests/test_admin_get_template.py`, `test_admin_import_structure.py`, `test_admin_finalize_version.py`, `test_user_call_llm.py`, `test_user_get_form.py`, `test_user_submit_answer.py`, `test_admin_get_version_detail.py`）を更新し、新しい FK に沿ったデータ生成と検証へ変更。
- Alembic の `0008` リビジョン ID を 32 文字以内へ調整し、MySQL でインデックス差し替えが安全に行えるよう rename 手順を組み込んだ。
- docker-compose 環境で `alembic upgrade head` を実行しテスト DB に反映後、`backend pytest -q` および `admin_front npm run test` を完走させ全件グリーンを確認（admin_front のテストコード修正は不要）。

## テスト結果
- `docker-compose run --rm -e ENV=test -e TEST_DATABASE_URL="mysql+pymysql://app:app@db_test:3306/app_test" backend pytest -q` : 96 passed (warnings only)
- `docker-compose run --rm admin_front sh -lc "npm ci || npm install; npm run test"` : 10 files / 34 tests passed

## 未完了・次の対応
- なし

## 不具合
### 内容
`_documents/diagnostics/ai_career/front/01_管理ダッシュボード.md`画面でimport->finalize->activateし、
`_documents/diagnostics/ai_career/front/03_共通診断画面.md`画面を照会すると質問は表示されるが選択肢が表示されない。

### 原因
`_documents/diagnostics/ai_career/DB設計.md`のversion_optionsテーブルのquestion_idがquestionテーブルと外部結合前提にしているため、
version_optionsからversion_questionsが参照できないテーブル構造になってしまっている。
また、この矛盾を孕んだままAPI、フロントエンドを実装しているので影響箇所全てを修正する必要がある。

## 修正方針
### 大方針
`_documents/diagnostics/ai_career/DB設計.md`のversion_optionsテーブルのquestion_idを`version_question_id`にリネームし、外部結合もversion_questionsテーブルに付け替える。
まず、関連ドキュメント全てを修正後に、テストコードを修正し、その後テストがオールグリーンになるように実装修正をする。

### 修正対象
#### ドキュメント
- _documents/diagnostics/ai_career/DB設計.md
- _documents/diagnostics/ai_career/APIs/03_admin_get_template.md
- _documents/diagnostics/ai_career/APIs/04_admin_import_structure.md
- _documents/diagnostics/ai_career/APIs/07_admin_finalize_version.md
- _documents/diagnostics/ai_career/APIs/21_user_get_form.md

#### テスト修正対象
- backend/tests/test_admin_get_template.py
- admin_front/tests/lib/templateDownloader.test.ts
- backend/tests/test_admin_import_structure.py
- admin_front/tests/components/ImportStructureCard.test.tsx
- backend/tests/test_admin_finalize_version.py
- admin_front/tests/components/FinalizeVersionCard.test.tsx
- backend/tests/test_user_get_form.py

#### 実装
テストコード見て修正箇所を特定してください
