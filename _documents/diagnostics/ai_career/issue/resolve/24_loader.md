## 現状の問題点
- `_documents/diagnostics/ai_career/front/03_共通診断画面.md` の初期表示では `20_user_start_session` や `21_user_get_form` の完了を待つ間に画面が空白のまま残り、ユーザーが再診断や戻る操作を繰り返すきっかけになっている。
- LLM 実行（`23_user_call_llm`）は Amazon Bedrock を利用するため 60 秒程度待機するケースが多く、回答送信後に画面が無反応に見える。結果として二重送信、ブラウザバック、タブ離脱が起こりセッションが破棄されてしまう。
- 共通診断画面から結果画面へ遷移する間に操作が可能なままのため、ローカルステートが破損したり、結果ページに `llm_result` が伝搬しないまま遷移して真っ白に見える事象が散発している。

## 解決方針
- API 応答待機中は画面全体を非アクティブにし、進行状況を明示するローダーを表示する。対象は質問フォーム初期化、回答送信、結果生成、結果再読込の各フローとする。
- ローダー表示中はフォーカス移動とクリックを遮断し、進行段階に合わせてメッセージを切り替えてユーザーへ処理中であることを伝える。
- エラー発生時はローダーを即時解除し、既存のエラービュー／リトライ導線を提示することで再実行を促す。

## 対応詳細
### 共通診断画面（`_documents/diagnostics/ai_career/front/03_共通診断画面.md`）
- 初期化フロー（手順 2〜5）に `isInitializingForm` ステートを追加し、true の間は全画面ローダーを表示する。`20_user_start_session`・`21_user_get_form` が完了し質問リストが描画できたタイミングで false に戻す。
- 既存セッションを復元する場合も `version_id` とローカルストレージの整合性チェックが終わるまではローダーを継続する。API 呼び出し不要なケースでも 300ms 程度の最小表示時間を設け、ちらつきを抑える。
- 「再診断する」を選択した場合はセッション再発行〜フォーム再取得までを `isReinitializing` として扱い、文言を「再診断の準備をしています...」へ切り替える。キャンセル時はローダーを閉じ、既存の選択状態へ戻す。

### 回答送信〜結果生成フロー（03→04 遷移）
- `回答を送信` ボタン押下で `isSubmittingAnswers` を true にし、「回答を送信しています...」というメッセージでローダーを表示する。この時点で質問ナビゲーションや選択肢は disabled とする。
- `22_user_submit_answer` が成功したら `isGeneratingResult` を true に切り替え、メッセージを「結果を生成しています」へ更新する。同時にローカルステートの `status` を `awaiting_llm` へ更新し、`version_options_hash` を保持したまま別セッションが再発行されないようにする。
- `23_user_call_llm` のレスポンス取得までローダーを維持し、レスポンスをローカルステートへ保存できたことを確認してから画面遷移する。成功時は `status=completed` を保存する。
- いずれかの API が失敗した場合はローダーを解除し、既存のエラーダイアログを表示する。再試行時はローダーを再び表示する。
- 既に `llm_result` が生成済みで「結果を表示する」を選択した場合はローダーをスキップし、結果画面へ即座に遷移する。

### 診断結果画面（`_documents/diagnostics/ai_career/front/04_診断結果画面.md`）
- 03 から遷移してきた際に `llm_result` が付与されていない場合は、`25_user_get_session` の完了までローダーを表示し、結果セットが揃うまで操作をブロックする。
- 共有リンク経由で直接アクセスした場合も同様にローダーを表示し、`llm_result=null` が返った際はエラービューへ遷移させる。

## UI仕様
- `LoaderOverlay`（仮称）コンポーネントを共有化し、`position: fixed`・`z-index` を最前面に設定してページ全体を覆う。背景は 0.4 程度のダークオーバーレイでクリックを遮断する。
- 中央にブランドカラーのスピナーとメッセージを縦配置する。メッセージは `aria-live="polite"` の `role="status"` を付与し、スクリーンリーダーに進捗を伝える。
- 表示文言の候補: 「診断内容を読み込んでいます...」「再診断の準備をしています...」「回答を送信しています...」「結果を生成しています...」。
- ローダー表示中は `document.body` のスクロールを固定し、フォーカストラップを解除しておく（自動的にオーバーレイへフォーカスを移し、閉じる操作は無効）。
- ローダー非表示時には最小表示時間を満たしていれば即座にフェードアウトする。アニメーションは 200ms 程度で統一する。

## タスク
- [ ] 規約を読む
  - [ ] `_documents/common/frontend/implementation_guidelines.md`
- [ ] 共通機能を理解する
  - [ ] `_documents/common/frontend/CommonFunctionality.md`
- [ ] 設計書を更新する
  - [ ] `_documents/diagnostics/ai_career/front/03_共通診断画面.md`
  - [ ] `_documents/diagnostics/ai_career/front/04_診断結果画面.md`
- [ ] 共通ローダー UI の仕様をフロント設計ドキュメントへ反映する（必要に応じて `_documents/diagnostics/ai_career/front/components` 系資料を追加）
- [ ] フロント実装（共通診断画面・結果画面）でローダー挙動を実装する
- [ ] テストを整備する
  - [ ] コンポーネント／フック単位のユニットテスト
  - [ ] 画面遷移を含む E2E テスト（ローディング挙動）
- [ ] 懸念点・引き継ぎ事項を `_documents/notion/diagnostics` に記載する

## テスト観点
- 初期表示時に `20_user_start_session`・`21_user_get_form` を遅延させ、ローダーが表示され続けて操作が無効化されていること。
- 再診断フローでローダー文言が切り替わり、キャンセル後にローダーが解除されること。
- 回答送信〜LLM 実行の遷移でローダーが段階的にメッセージを切り替え、API 失敗時に即座に解除されること。
- `llm_result` が即時返却されるケースで不必要なちらつきが発生しないこと（最小表示時間で制御できているか）。
- 結果画面単体アクセス（共有リンク）時にローダーが表示され、`llm_result=null` でエラービューへ遷移すること。
